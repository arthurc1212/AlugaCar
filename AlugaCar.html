<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>AlugaCar — Painel</title>
  <style>
    :root{--bg:#f4f4f4;--card:#fff;--accent:#2e8b57;--muted:#777}
    *{box-sizing:border-box}
    body{font-family:Arial,Helvetica,sans-serif;background:var(--bg);margin:0;padding:20px}
    header{display:flex;align-items:center;justify-content:space-between;gap:12px}
    h1{margin:0;color:#333}
    .wrap{max-width:1100px;margin:18px auto}
    .card{background:var(--card);padding:18px;border-radius:8px;box-shadow:0 6px 18px rgba(0,0,0,0.06);margin-bottom:18px}

    /* Tabs */
    .tabs{display:flex;gap:8px;margin-bottom:12px}
    .tabs button{background:transparent;border:1px solid #ddd;padding:8px 12px;border-radius:6px;cursor:pointer}
    .tabs button.active{background:var(--accent);color:#fff;border-color:var(--accent)}

    form{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    label{display:block;font-size:13px;color:#333}
    input,select{width:100%;padding:8px;border:1px solid #ccc;border-radius:6px}
    .full{grid-column:1/-1}
    .actions{display:flex;gap:8px;justify-content:flex-end}
    .btn{padding:8px 12px;border-radius:6px;border:0;cursor:pointer}
    .btn.primary{background:var(--accent);color:#fff}
    .btn.warn{background:#f39c12;color:#fff}
    .btn.ghost{background:transparent;border:1px solid #ddd}

    table{width:100%;border-collapse:collapse;margin-top:12px}
    th,td{padding:8px;border:1px solid #eee;text-align:left}
    th{background:#2e8b57;color:#fff}
    tr:nth-child(even){background:#fafafa}

    .muted{color:var(--muted);font-size:13px}

    /* small screens */
    @media (max-width:720px){form{grid-template-columns:1fr}
      .actions{flex-direction:column-reverse}
    }
  </style>
</head>
<body>
  <div class="wrap">
    
    <div class="card">
      <div class="tabs" role="tablist">
        <button id="tab-users" class="active">Usuários</button>
        <button id="tab-cars">Carros</button>
        <button id="tab-rentals">Aluguéis</button>
      </div>

      <!-- USERS -->
      <section id="panel-users">
        <form id="form-user">
          <div>
            <label for="user-name">Nome</label>
            <input id="user-name" required />
          </div>
          <div>
            <label for="user-cpf">CPF / ID</label>
            <input id="user-cpf" required />
          </div>
          <div>
            <label for="user-phone">Telefone</label>
            <input id="user-phone" />
          </div>
          <div>
            <label for="user-email">E‑mail</label>
            <input id="user-email" type="email" />
          </div>
          <div class="full">
            <label for="user-address">Endereço</label>
            <input id="user-address" />
          </div>

          <div class="full actions">
            <button type="button" class="btn ghost" id="clear-users">Limpar</button>
            <button type="submit" class="btn primary">Cadastrar Usuário</button>
          </div>
        </form>

        <div style="margin-top:18px">
          <h3>Lista de Usuários</h3>
          <table id="table-users">
            <thead>
              <tr><th>#</th><th>Nome</th><th>CPF/ID</th><th>Telefone</th><th>Endereço</th><th>Ações</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- CARS -->
      <section id="panel-cars" style="display:none">
        <form id="form-car">
          <div>
            <label for="car-model">Modelo</label>
            <input id="car-model" required />
          </div>
          <div>
            <label for="car-plate">Placa</label>
            <input id="car-plate" required />
          </div>
          <div>
            <label for="car-year">Ano</label>
            <input id="car-year" type="number" />
          </div>
          <div>
            <label for="car-price">Preço por dia (R$)</label>
            <input id="car-price" type="number" step="0.01" />
          </div>
          <div class="full">
            <label for="car-status">Status</label>
            <select id="car-status"><option value="available">Disponível</option><option value="rented">Alugado</option></select>
          </div>

          <div class="full actions">
            <button type="button" class="btn ghost" id="clear-cars">Limpar</button>
            <button type="submit" class="btn primary">Cadastrar Carro</button>
          </div>
        </form>

        <div style="margin-top:18px">
          <h3>Lista de Carros</h3>
          <table id="table-cars">
            <thead>
              <tr><th>#</th><th>Modelo</th><th>Placa</th><th>Ano</th><th>Preço/dia</th><th>Status</th><th>Ações</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

      <!-- RENTALS -->
      <section id="panel-rentals" style="display:none">
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:220px">
            <label for="rent-user">Usuário</label>
            <select id="rent-user"></select>
          </div>
          <div style="flex:1;min-width:220px">
            <label for="rent-car">Carro</label>
            <select id="rent-car"></select>
          </div>
          <div style="flex:1;min-width:160px">
            <label for="rent-days">Dias</label>
            <input id="rent-days" type="number" value="1" />
          </div>
          <div style="display:flex;align-items:flex-end;gap:8px">
            <button id="do-rent" class="btn primary">Alugar</button>
            <button id="return-rent" class="btn warn">Devolver</button>
          </div>
        </div>

        <div style="margin-top:18px">
          <h3>Aluguéis</h3>
          <table id="table-rentals">
            <thead>
              <tr><th>#</th><th>Usuário</th><th>Carro</th><th>Dias</th><th>Total (R$)</th><th>Status</th><th>Ações</th></tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </section>

    </div>
  </div>

  <script>
    // --- Helpers: data persistence
    const API_AVAILABLE = false; // ajuste para true se tiver endpoints
    const storage = {
      users: () => JSON.parse(localStorage.getItem('ac_users')||'[]'),
      cars: () => JSON.parse(localStorage.getItem('ac_cars')||'[]'),
      rentals: () => JSON.parse(localStorage.getItem('ac_rentals')||'[]'),
      save(users,cars,rentals){localStorage.setItem('ac_users',JSON.stringify(users));localStorage.setItem('ac_cars',JSON.stringify(cars));localStorage.setItem('ac_rentals',JSON.stringify(rentals));}
    }

    // --- UI binding
    const tabs = {users:document.getElementById('tab-users'),cars:document.getElementById('tab-cars'),rentals:document.getElementById('tab-rentals')}
    const panels = {users:document.getElementById('panel-users'),cars:document.getElementById('panel-cars'),rentals:document.getElementById('panel-rentals')}
    Object.keys(tabs).forEach(k=>{tabs[k].addEventListener('click',()=>{Object.values(tabs).forEach(b=>b.classList.remove('active'));tabs[k].classList.add('active');Object.values(panels).forEach(p=>p.style.display='none');panels[k].style.display='block';refreshAll();})})

    // Forms
    const formUser = document.getElementById('form-user');
    const formCar = document.getElementById('form-car');

    formUser.addEventListener('submit',e=>{e.preventDefault();addUser();});
    formCar.addEventListener('submit',e=>{e.preventDefault();addCar();});
    document.getElementById('clear-users').addEventListener('click',()=>formUser.reset());
    document.getElementById('clear-cars').addEventListener('click',()=>formCar.reset());

    // RENT
    document.getElementById('do-rent').addEventListener('click',doRent);
    document.getElementById('return-rent').addEventListener('click',doReturn);

    // --- CRUD operations (localStorage fallback)
    function addUser(){
      const users = storage.users();
      const u = {id:Date.now(),name:el('user-name').value,cpf:el('user-cpf').value,phone:el('user-phone').value,address:el('user-address').value,email:el('user-email').value};
      users.push(u); storage.save(users,storage.cars(),storage.rentals()); refreshAll(); formUser.reset();}
    function addCar(){
      const cars = storage.cars();
      const c = {id:Date.now(),model:el('car-model').value,plate:el('car-plate').value,year:el('car-year').value,price:parseFloat(el('car-price').value)||0,status:el('car-status').value};
      cars.push(c); storage.save(storage.users(),cars,storage.rentals()); refreshAll(); formCar.reset();}

    function doRent(){
      const userId = parseInt(el('rent-user').value); const carId = parseInt(el('rent-car').value); const days = parseInt(el('rent-days').value)||1;
      if(!userId||!carId){alert('Escolha usuário e carro');return}
      const users = storage.users(); const cars = storage.cars(); const rentals = storage.rentals();
      const car = cars.find(x=>x.id===carId); if(!car||car.status==='rented'){alert('Carro indisponível');return}
      const user = users.find(x=>x.id===userId);
      const total = (car.price||0)*days;
      const r = {id:Date.now(),userId,carId,days,total,status:'ongoing',userName:user.name,carModel:car.model};
      rentals.push(r); car.status='rented'; storage.save(users,cars,rentals); refreshAll();}

    function doReturn(){
      const sel = document.querySelector('#table-rentals tbody tr.selected');
      if(!sel){alert('Selecione um aluguel na lista');return}
      const id = parseInt(sel.dataset.id);
      const rentals = storage.rentals(); const cars = storage.cars();
      const r = rentals.find(x=>x.id===id); if(!r){alert('Aluguel não encontrado');return}
      r.status='finished'; const car = cars.find(x=>x.id===r.carId); if(car)car.status='available'; storage.save(storage.users(),cars,rentals); refreshAll();}

    // --- Render
    function refreshAll(){renderUsers();renderCars();renderRentals();populateSelects();}
    function renderUsers(){const tbody=document.querySelector('#table-users tbody');tbody.innerHTML='';const users=storage.users();users.forEach((u,i)=>{const tr=document.createElement('tr');tr.dataset.id=u.id;tr.innerHTML=`<td>${i+1}</td><td>${u.name}</td><td>${u.cpf}</td><td>${u.phone||''}</td><td>${u.address||''}</td><td><button class='btn ghost' onclick='editUser(${u.id})'>Editar</button> <button class='btn warn' onclick='deleteUser(${u.id})'>Excluir</button></td>`;tbody.appendChild(tr)})}
    function renderCars(){const tbody=document.querySelector('#table-cars tbody');tbody.innerHTML='';const cars=storage.cars();cars.forEach((c,i)=>{const tr=document.createElement('tr');tr.dataset.id=c.id;tr.innerHTML=`<td>${i+1}</td><td>${c.model}</td><td>${c.plate}</td><td>${c.year||''}</td><td>${Number(c.price).toFixed(2)}</td><td>${c.status}</td><td><button class='btn ghost' onclick='editCar(${c.id})'>Editar</button> <button class='btn warn' onclick='deleteCar(${c.id})'>Excluir</button></td>`;tbody.appendChild(tr)})}
    function renderRentals(){const tbody=document.querySelector('#table-rentals tbody');tbody.innerHTML='';const rentals=storage.rentals();rentals.forEach((r,i)=>{const tr=document.createElement('tr');tr.dataset.id=r.id;tr.innerHTML=`<td>${i+1}</td><td>${r.userName||r.userId}</td><td>${r.carModel||r.carId}</td><td>${r.days}</td><td>${Number(r.total).toFixed(2)}</td><td>${r.status}</td><td><button class='btn ghost' onclick='selectRentalRow(this)'>Selecionar</button></td>`;tbody.appendChild(tr)})}

    function populateSelects(){const users=storage.users();const cars=storage.cars();const su=el('rent-user');const sc=el('rent-car');su.innerHTML='';sc.innerHTML='';users.forEach(u=>{su.appendChild(opt(u.id,u.name))});cars.filter(c=>c.status!=='rented').forEach(c=>{sc.appendChild(opt(c.id,c.model+' — '+c.plate))})}

    // --- small utilities / global functions used in HTML inline handlers
    function el(id){return document.getElementById(id)}
    function opt(v,t){const o=document.createElement('option');o.value=v;o.textContent=t;return o}
    window.editUser=function(id){const users=storage.users();const u=users.find(x=>x.id===id);if(!u)return;el('user-name').value=u.name;el('user-cpf').value=u.cpf;el('user-phone').value=u.phone;el('user-address').value=u.address;el('user-email').value=u.email; tabs.users.click();}
    window.deleteUser=function(id){let users=storage.users();users=users.filter(x=>x.id!==id);storage.save(users,storage.cars(),storage.rentals());refreshAll();}
    window.editCar=function(id){const cars=storage.cars();const c=cars.find(x=>x.id===id);if(!c)return;el('car-model').value=c.model;el('car-plate').value=c.plate;el('car-year').value=c.year;el('car-price').value=c.price;el('car-status').value=c.status;tabs.cars.click();}
    window.deleteCar=function(id){let cars=storage.cars();cars=cars.filter(x=>x.id!==id);storage.save(storage.users(),cars,storage.rentals());refreshAll();}

    window.selectRentalRow=function(btn){const tr=btn.closest('tr');document.querySelectorAll('#table-rentals tbody tr').forEach(r=>r.classList.remove('selected'));tr.classList.add('selected')}

    // init
    refreshAll();
  </script>
</body>
</html>

